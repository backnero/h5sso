{"version":3,"sources":["webpack:///src/pages/mobile/account/bind/index.vue","webpack:///./src/pages/mobile/account/bind/index.vue?37a9","webpack:///./src/pages/mobile/account/bind/index.vue"],"names":["bind","uuid","code","mixins_user","this","then","res","risk_level","sendText","_this2","countdown","_this3","count","timer","_this4","Object","stringify_default","id","refresh","value","ruleForm","_this5","phone","valideCode","verify_status","refreshCode","smscode","_this6","_this","$store","dispatch","toString","status","account_bind","render","_vm","_h","$createElement","_c","_self","staticClass","ref","attrs","action","directives","name","rawName","expression","type","placeholder","domProps","on","input","$event","target","composing","$set","_v","securityLevel","click","width","height","lazy-load","src","b64s","_e","getCode","show","_s","preventDefault","submitForm","staticRenderFns","Component","__webpack_require__","normalizeComponent","ssrContext","__webpack_exports__"],"mappings":"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","file":"static/js/10.c41ead2319fb617c0324.js","sourcesContent":["<template>\r\n  <div class=\"bind-wrapper\">\r\n    <form action ref=\"form-wrapper\" class=\"form-wrapper\">\r\n      <div class=\"input-wrapper\">\r\n        <div class=\"text-input\">\r\n          <input type=\"text\" v-model=\"ruleForm.phone\" placeholder=\"输入手机号\" />\r\n        </div>\r\n      </div>\r\n      <div class=\"input-wrapper\" v-if=\"securityLevel>0\">\r\n        <div class=\"text-input\">\r\n          <input type=\"text\" v-model=\"ruleForm.code\" placeholder=\"请输入图形码的答案\" />\r\n        </div>\r\n        <div class=\"code\" @click=\"refreshCode\">\r\n          <van-image width=\"100%\" height=\"100%\" lazy-load :src=\"refresh.b64s\" />\r\n        </div>\r\n      </div>\r\n      <div class=\"input-wrapper\">\r\n        <div class=\"text-input\">\r\n          <input type=\"text\" v-model=\"ruleForm.smscode\" placeholder=\"短信验证码\" />\r\n        </div>\r\n        <div class=\"getValid\">\r\n          <span v-show=\"show\" @click=\"getCode\">发送验证码</span>\r\n          <span v-show=\"!show\" class=\"count\">{{count}}s后重新发送</span>\r\n        </div>\r\n      </div>\r\n      <div class=\"submit-wrapper\">\r\n        <button type=\"submit\" @click.prevent=\"submitForm\" class=\"submit\">确定</button>\r\n      </div>\r\n    </form>\r\n  </div>\r\n</template>\r\n\r\n<script>\r\nimport { setPhone } from \"@/api/user\";\r\nimport { getCode } from \"@/mixins/user\";\r\nimport { getCode as getCode_api, captcha } from \"@/api/code\";\r\nimport { getSecurity_Level } from \"@/api/user\";\r\nimport { isPhone, isSmsCode } from \"@/utils/validate\";\r\nexport default {\r\n  components: {},\r\n  props: {},\r\n  data() {\r\n    return {\r\n      uuid: this.$route.params.uuid,\r\n      disposable_code: this.$route.params.code,\r\n      securityLevel: 0,\r\n      show: true,\r\n      count: \"\",\r\n      timer: null,\r\n      checked: false,\r\n      refresh: {\r\n        b64s: \"\",\r\n        id: \"\",\r\n      },\r\n      ruleForm: {\r\n        phone: \"\",\r\n        code: \"\",\r\n        smscode: \"\",\r\n      },\r\n    };\r\n  },\r\n  mixins: [getCode],\r\n  watch: {},\r\n  computed: {},\r\n  methods: {\r\n    getCode(event) {\r\n      let _this = this;\r\n      this.$reCaptcha(event, \"smsCode\")\r\n        .then((res) => {\r\n          let obj = JSON.stringify({ response: res });\r\n          return obj;\r\n        })\r\n        .then((res) => {\r\n          getSecurity_Level(res).then((res) => {\r\n            // console.log(res.data.risk_level);\r\n            _this.securityLevel = res.data.risk_level;\r\n            if (isPhone(_this.ruleForm.phone)) {\r\n              if (res.data.risk_level > 0) {\r\n                _this.valideCode().then((res) => {\r\n                  if (res.data.verify_status) {\r\n                    _this.sendText();\r\n                  } else {\r\n                    _this.$toast(\"请先填写正确的图形码\");\r\n                    return false;\r\n                  }\r\n                });\r\n              } else {\r\n                _this.sendText();\r\n              }\r\n            } else {\r\n              _this.$toast(\"请先填写手机号\");\r\n              return false;\r\n            }\r\n          });\r\n        });\r\n    },\r\n    sendText() {\r\n      let _this = this;\r\n      getCode_api(_this.ruleForm.phone).then((response) => {\r\n        this.$toast.success(\"发送成功!\");\r\n        _this.countdown();\r\n      });\r\n    },\r\n    countdown() {\r\n      const TIME_COUNT = 60;\r\n      if (!this.timer) {\r\n        this.count = TIME_COUNT;\r\n        this.show = false;\r\n        this.timer = setInterval(() => {\r\n          if (this.count > 0 && this.count <= TIME_COUNT) {\r\n            this.count--;\r\n          } else {\r\n            this.show = true;\r\n            clearInterval(this.timer);\r\n            this.timer = null;\r\n          }\r\n        }, 1000);\r\n      }\r\n    },\r\n    async valideCode() {\r\n      return await captcha(\r\n        JSON.stringify({ id: this.refresh.id, value: this.ruleForm.code })\r\n      );\r\n    },\r\n    async rules() {\r\n      if (this.ruleForm.phone !== \"\") {\r\n        if (!isPhone(this.ruleForm.phone)) {\r\n          this.$toast(\"请填写正确手机号\");\r\n          return false;\r\n        }\r\n      } else {\r\n        this.$toast(\"手机号不能为空\");\r\n        return false;\r\n      }\r\n      if (this.securityLevel !== 0) {\r\n        if (this.ruleForm.code !== \"\") {\r\n          let response = await this.valideCode();\r\n          if (!response.data.verify_status) {\r\n            this.refreshCode();\r\n            this.$toast(\"请填写正确的图形码\");\r\n            return false;\r\n          }\r\n        } else {\r\n          this.$toast(\"图形码不能为空\");\r\n          return false;\r\n        }\r\n      }\r\n      if (this.ruleForm.smscode !== \"\") {\r\n        if (!isSmsCode(this.ruleForm.smscode)) {\r\n          this.$toast(\"请填写正确的验证码\");\r\n          return false;\r\n        }\r\n      } else {\r\n        this.$toast(\"验证码不能为空\");\r\n        return false;\r\n      }\r\n      return true;\r\n    },\r\n    submitForm(event) {\r\n      this.$reCaptcha(event, \"bindPhone\");\r\n      this.rules().then((valid) => {\r\n        if (valid) {\r\n          let _this = this;\r\n          _this.$store\r\n            .dispatch(\"bind_phone\", {\r\n              tpl_id: this.uuid,\r\n              disposable_code:this.disposable_code.toString(),\r\n              phone_num: this.ruleForm.phone,\r\n              phone_code: this.ruleForm.smscode,\r\n            })\r\n            .then((status) => {\r\n              if (status) {\r\n                _this.$toast.loading({\r\n                  message: \"设置成功!跳转中...\",\r\n                  forbidClick: true,\r\n                  loadingType: \"spinner\",\r\n                });\r\n              } else {\r\n                _this.$toast.fail(\"token:undefind\");\r\n              }\r\n            }).catch(error=>{\r\n              _this.$router.push({ name: 'm_account' })\r\n            });\r\n        } else {\r\n          return false;\r\n        }\r\n      });\r\n    },\r\n  },\r\n  created() {},\r\n  mounted() {},\r\n};\r\n</script>\r\n<style lang=\"scss\" scoped>\r\n@import \"@/assets/styles/mobile/index.scss\";\r\n.bind-wrapper {\r\n  width: 100%;\r\n  height: 100%;\r\n  .form-wrapper {\r\n    width: 100%;\r\n    padding: 40px;\r\n    box-sizing: border-box;\r\n    .slider {\r\n      width: 100%;\r\n      height: 40px;\r\n      background-color: #eeeeee;\r\n      margin-bottom: 35px;\r\n    }\r\n    .input-wrapper:nth-of-type(2) {\r\n      margin-bottom: 25px;\r\n    }\r\n  }\r\n}\r\n</style>\n\n\n// WEBPACK FOOTER //\n// src/pages/mobile/account/bind/index.vue","var render = function () {var _vm=this;var _h=_vm.$createElement;var _c=_vm._self._c||_h;return _c('div',{staticClass:\"bind-wrapper\"},[_c('form',{ref:\"form-wrapper\",staticClass:\"form-wrapper\",attrs:{\"action\":\"\"}},[_c('div',{staticClass:\"input-wrapper\"},[_c('div',{staticClass:\"text-input\"},[_c('input',{directives:[{name:\"model\",rawName:\"v-model\",value:(_vm.ruleForm.phone),expression:\"ruleForm.phone\"}],attrs:{\"type\":\"text\",\"placeholder\":\"输入手机号\"},domProps:{\"value\":(_vm.ruleForm.phone)},on:{\"input\":function($event){if($event.target.composing){ return; }_vm.$set(_vm.ruleForm, \"phone\", $event.target.value)}}})])]),_vm._v(\" \"),(_vm.securityLevel>0)?_c('div',{staticClass:\"input-wrapper\"},[_c('div',{staticClass:\"text-input\"},[_c('input',{directives:[{name:\"model\",rawName:\"v-model\",value:(_vm.ruleForm.code),expression:\"ruleForm.code\"}],attrs:{\"type\":\"text\",\"placeholder\":\"请输入图形码的答案\"},domProps:{\"value\":(_vm.ruleForm.code)},on:{\"input\":function($event){if($event.target.composing){ return; }_vm.$set(_vm.ruleForm, \"code\", $event.target.value)}}})]),_vm._v(\" \"),_c('div',{staticClass:\"code\",on:{\"click\":_vm.refreshCode}},[_c('van-image',{attrs:{\"width\":\"100%\",\"height\":\"100%\",\"lazy-load\":\"\",\"src\":_vm.refresh.b64s}})],1)]):_vm._e(),_vm._v(\" \"),_c('div',{staticClass:\"input-wrapper\"},[_c('div',{staticClass:\"text-input\"},[_c('input',{directives:[{name:\"model\",rawName:\"v-model\",value:(_vm.ruleForm.smscode),expression:\"ruleForm.smscode\"}],attrs:{\"type\":\"text\",\"placeholder\":\"短信验证码\"},domProps:{\"value\":(_vm.ruleForm.smscode)},on:{\"input\":function($event){if($event.target.composing){ return; }_vm.$set(_vm.ruleForm, \"smscode\", $event.target.value)}}})]),_vm._v(\" \"),_c('div',{staticClass:\"getValid\"},[_c('span',{directives:[{name:\"show\",rawName:\"v-show\",value:(_vm.show),expression:\"show\"}],on:{\"click\":_vm.getCode}},[_vm._v(\"发送验证码\")]),_vm._v(\" \"),_c('span',{directives:[{name:\"show\",rawName:\"v-show\",value:(!_vm.show),expression:\"!show\"}],staticClass:\"count\"},[_vm._v(_vm._s(_vm.count)+\"s后重新发送\")])])]),_vm._v(\" \"),_c('div',{staticClass:\"submit-wrapper\"},[_c('button',{staticClass:\"submit\",attrs:{\"type\":\"submit\"},on:{\"click\":function($event){$event.preventDefault();return _vm.submitForm($event)}}},[_vm._v(\"确定\")])])])])}\nvar staticRenderFns = []\nvar esExports = { render: render, staticRenderFns: staticRenderFns }\nexport default esExports\n\n\n//////////////////\n// WEBPACK FOOTER\n// ./node_modules/vue-loader/lib/template-compiler?{\"id\":\"data-v-ad32b5ce\",\"hasScoped\":true,\"transformToRequire\":{\"video\":[\"src\",\"poster\"],\"source\":\"src\",\"img\":\"src\",\"image\":\"xlink:href\"},\"buble\":{\"transforms\":{}}}!./node_modules/vue-loader/lib/selector.js?type=template&index=0!./src/pages/mobile/account/bind/index.vue\n// module id = null\n// module chunks = ","function injectStyle (ssrContext) {\n  require(\"!!../../../../../node_modules/extract-text-webpack-plugin/dist/loader.js?{\\\"omit\\\":1,\\\"remove\\\":true,\\\"publicPath\\\":\\\"../../\\\"}!vue-style-loader!css-loader?{\\\"sourceMap\\\":true}!../../../../../node_modules/vue-loader/lib/style-compiler/index?{\\\"vue\\\":true,\\\"id\\\":\\\"data-v-ad32b5ce\\\",\\\"scoped\\\":true,\\\"hasInlineConfig\\\":false}!sass-loader?{\\\"sourceMap\\\":true}!../../../../../node_modules/vue-loader/lib/selector?type=styles&index=0!./index.vue\")\n}\nvar normalizeComponent = require(\"!../../../../../node_modules/vue-loader/lib/component-normalizer\")\n/* script */\nexport * from \"!!babel-loader!../../../../../node_modules/vue-loader/lib/selector?type=script&index=0!./index.vue\"\nimport __vue_script__ from \"!!babel-loader!../../../../../node_modules/vue-loader/lib/selector?type=script&index=0!./index.vue\"\n/* template */\nimport __vue_template__ from \"!!../../../../../node_modules/vue-loader/lib/template-compiler/index?{\\\"id\\\":\\\"data-v-ad32b5ce\\\",\\\"hasScoped\\\":true,\\\"transformToRequire\\\":{\\\"video\\\":[\\\"src\\\",\\\"poster\\\"],\\\"source\\\":\\\"src\\\",\\\"img\\\":\\\"src\\\",\\\"image\\\":\\\"xlink:href\\\"},\\\"buble\\\":{\\\"transforms\\\":{}}}!../../../../../node_modules/vue-loader/lib/selector?type=template&index=0!./index.vue\"\n/* template functional */\nvar __vue_template_functional__ = false\n/* styles */\nvar __vue_styles__ = injectStyle\n/* scopeId */\nvar __vue_scopeId__ = \"data-v-ad32b5ce\"\n/* moduleIdentifier (server only) */\nvar __vue_module_identifier__ = null\nvar Component = normalizeComponent(\n  __vue_script__,\n  __vue_template__,\n  __vue_template_functional__,\n  __vue_styles__,\n  __vue_scopeId__,\n  __vue_module_identifier__\n)\n\nexport default Component.exports\n\n\n\n//////////////////\n// WEBPACK FOOTER\n// ./src/pages/mobile/account/bind/index.vue\n// module id = null\n// module chunks = "],"sourceRoot":""}