webpackJsonp([10],{"dZ+W":function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var n=r("Xxa5"),s=r.n(n),a=r("exGp"),o=r.n(a),i=r("mvHQ"),u=r.n(i),c=r("vMJZ"),d=r("bS7a"),l=r("k3x/"),p=r("E4LH"),m={components:{},props:{},data:function(){return{uuid:this.$route.params.uuid,disposable_code:this.$route.params.code,securityLevel:0,show:!0,count:"",timer:null,checked:!1,refresh:{b64s:"",id:""},ruleForm:{phone:"",code:"",smscode:""}}},mixins:[d.b],watch:{},computed:{},methods:{getCode:function(e){var t=this;this.$reCaptcha(e,"smsCode").then(function(e){return u()({response:e})}).then(function(e){Object(c.c)(e).then(function(e){if(t.securityLevel=e.data.risk_level,!Object(p.d)(t.ruleForm.phone))return t.$toast("请先填写手机号"),!1;e.data.risk_level>0?t.valideCode().then(function(e){if(!e.data.verify_status)return t.$toast("请先填写正确的图形码"),!1;t.sendText()}):t.sendText()})})},sendText:function(){var e=this,t=this;Object(l.b)(t.ruleForm.phone).then(function(r){e.$toast.success("发送成功!"),t.countdown()})},countdown:function(){var e=this;this.timer||(this.count=60,this.show=!1,this.timer=setInterval(function(){e.count>0&&e.count<=60?e.count--:(e.show=!0,clearInterval(e.timer),e.timer=null)},1e3))},valideCode:function(){var e=this;return o()(s.a.mark(function t(){return s.a.wrap(function(t){for(;;)switch(t.prev=t.next){case 0:return t.next=2,Object(l.a)(u()({id:e.refresh.id,value:e.ruleForm.code}));case 2:return t.abrupt("return",t.sent);case 3:case"end":return t.stop()}},t,e)}))()},rules:function(){var e=this;return o()(s.a.mark(function t(){return s.a.wrap(function(t){for(;;)switch(t.prev=t.next){case 0:if(""===e.ruleForm.phone){t.next=6;break}if(Object(p.d)(e.ruleForm.phone)){t.next=4;break}return e.$toast("请填写正确手机号"),t.abrupt("return",!1);case 4:t.next=8;break;case 6:return e.$toast("手机号不能为空"),t.abrupt("return",!1);case 8:if(0===e.securityLevel){t.next=21;break}if(""===e.ruleForm.code){t.next=19;break}return t.next=12,e.valideCode();case 12:if(t.sent.data.verify_status){t.next=17;break}return e.refreshCode(),e.$toast("请填写正确的图形码"),t.abrupt("return",!1);case 17:t.next=21;break;case 19:return e.$toast("图形码不能为空"),t.abrupt("return",!1);case 21:if(""===e.ruleForm.smscode){t.next=27;break}if(Object(p.e)(e.ruleForm.smscode)){t.next=25;break}return e.$toast("请填写正确的验证码"),t.abrupt("return",!1);case 25:t.next=29;break;case 27:return e.$toast("验证码不能为空"),t.abrupt("return",!1);case 29:return t.abrupt("return",!0);case 30:case"end":return t.stop()}},t,e)}))()},submitForm:function(e){var t=this;this.$reCaptcha(e,"bindPhone"),this.rules().then(function(e){if(!e)return!1;var r=t;r.$store.dispatch("bind_phone",{tpl_id:t.uuid,disposable_code:t.disposable_code.toString(),phone_num:t.ruleForm.phone,phone_code:t.ruleForm.smscode}).then(function(e){e?r.$toast.loading({message:"设置成功!跳转中...",forbidClick:!0,loadingType:"spinner"}):r.$toast.fail("token:undefind")}).catch(function(e){r.$router.push({name:"m_account"})})})}},created:function(){},mounted:function(){}},v={render:function(){var e=this,t=e.$createElement,r=e._self._c||t;return r("div",{staticClass:"bind-wrapper"},[r("form",{ref:"form-wrapper",staticClass:"form-wrapper",attrs:{action:""}},[r("div",{staticClass:"input-wrapper"},[r("div",{staticClass:"text-input"},[r("input",{directives:[{name:"model",rawName:"v-model",value:e.ruleForm.phone,expression:"ruleForm.phone"}],attrs:{type:"text",placeholder:"输入手机号"},domProps:{value:e.ruleForm.phone},on:{input:function(t){t.target.composing||e.$set(e.ruleForm,"phone",t.target.value)}}})])]),e._v(" "),e.securityLevel>0?r("div",{staticClass:"input-wrapper"},[r("div",{staticClass:"text-input"},[r("input",{directives:[{name:"model",rawName:"v-model",value:e.ruleForm.code,expression:"ruleForm.code"}],attrs:{type:"text",placeholder:"请输入图形码的答案"},domProps:{value:e.ruleForm.code},on:{input:function(t){t.target.composing||e.$set(e.ruleForm,"code",t.target.value)}}})]),e._v(" "),r("div",{staticClass:"code",on:{click:e.refreshCode}},[r("van-image",{attrs:{width:"100%",height:"100%","lazy-load":"",src:e.refresh.b64s}})],1)]):e._e(),e._v(" "),r("div",{staticClass:"input-wrapper"},[r("div",{staticClass:"text-input"},[r("input",{directives:[{name:"model",rawName:"v-model",value:e.ruleForm.smscode,expression:"ruleForm.smscode"}],attrs:{type:"text",placeholder:"短信验证码"},domProps:{value:e.ruleForm.smscode},on:{input:function(t){t.target.composing||e.$set(e.ruleForm,"smscode",t.target.value)}}})]),e._v(" "),r("div",{staticClass:"getValid"},[r("span",{directives:[{name:"show",rawName:"v-show",value:e.show,expression:"show"}],on:{click:e.getCode}},[e._v("发送验证码")]),e._v(" "),r("span",{directives:[{name:"show",rawName:"v-show",value:!e.show,expression:"!show"}],staticClass:"count"},[e._v(e._s(e.count)+"s后重新发送")])])]),e._v(" "),r("div",{staticClass:"submit-wrapper"},[r("button",{staticClass:"submit",attrs:{type:"submit"},on:{click:function(t){return t.preventDefault(),e.submitForm(t)}}},[e._v("确定")])])])])},staticRenderFns:[]};var h=r("VU/8")(m,v,!1,function(e){r("qkUn")},"data-v-ad32b5ce",null);t.default=h.exports},qkUn:function(e,t){}});
//# sourceMappingURL=10.c41ead2319fb617c0324.js.map